<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>大医精诚</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/phone.css">
</head>

<body>
    <section>
        <video id='my_video' autoplay></video>
        <div class="chat">
            <video id='other_video1' autoplay></video>
            <video id='other_video2' autoplay></video>
        </div>
    </section>
    <script type="text/javascript" src="js/SkyRTC-client.js"></script>
    <script>
        var my_video = document.getElementById("my_video");
        var other_video1 = document.getElementById("other_video1");
        var other_video2 = document.getElementById("other_video2");
        var rtc = SkyRTC();
        //自己的视频禁音
        my_video.volume = 0;

        //成功创建WebSocket连接
        rtc.on("connected", function (socket) {
            //创建本地视频流
            rtc.createStream({
                "video": true,
                "audio": true
            });
        });
        //创建本地视频流成功
        rtc.on("stream_created", function (stream) {
            my_video.src = URL.createObjectURL(stream);
            my_video.play();
        });
        //创建本地视频流失败
        rtc.on("stream_create_error", function () {
            alert("create stream failed!");
        });
        //接收到其他用户的视频流
        rtc.on('pc_add_stream', function (stream, socketId) {
            console.log(socketId)
            // var id = 'other_video1'
            // rtc.attachStream(stream, id);
        });
        //删除其他用户
        rtc.on('remove_peer', function (socketId) {
            if (other_video) {
                video.parentNode.removeChild(video);
            }
        });
        //连接WebSocket服务器
        rtc.connect("wss:" + window.location.href.substring(window.location.protocol.length).split('#')[0], window.location.hash.slice(1));

        function GetQueryString(name) {
            var after = window.location.search.split("?")[1];
            if (after) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = after.match(reg);
                if (r != null) {
                    return decodeURIComponent(r[2]);
                }
                {
                    return null;
                }
            }
        }
    </script>
</body>

</html>